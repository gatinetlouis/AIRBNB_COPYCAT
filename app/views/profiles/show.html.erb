<div class="container my-5">
  <% if policy(User.find(params[:id])).show? %>
    <%= link_to "Change password", edit_user_registration_path, class: 'btn btn-primary mb-3' %>
    <p><%= link_to "All rentals (you rent others' car)", rentals_path, class: 'btn btn-primary' %></p>
    <% unless current_user.cars.blank? %>
      <p><%= link_to "All cars", profile_cars_path(current_user), class: 'btn btn-primary' %></p>
    <% end %>
    <p><%= link_to "Add a car", new_car_path, class: 'btn btn-primary' %></p>
  <% end %>
  <%= link_to 'Logout', destroy_user_session_path, method: :delete %>
</div>

<ul class="nav nav-pills px-4 py-3 flex-column">
  <li class="nav-item mb-3">
    <a class="btn" data-toggle="collapse" href="#allyourrentals" role="button" aria-expanded="false" aria-controls="collapseExample">
      All your rentals
    </a>
  </li>
  <li class="nav-item">
    <a class="btn" data-toggle="collapse" href="#allyourcars" role="button" aria-expanded="false" aria-controls="collapseExample">
      All your cars
    </a>
  </li>
</ul>

<div class="collapse" id="allyourrentals">
  <div class="card card-body">
    <div class="container my-5">
      <h1>All your rentals</h1>
      <div class="row">
        <% current_user.rentals.each do |rental| %>
          <div class="col-sm-4">
            <div class="card rental-card mt-5">
              <%= cl_image_tag rental.car.photo.key, crop: :fill, class: "card-img-top" %>
              <div class="card-body">
                <h5 class="card-title"><%= Car.find(rental.car_id).model %></h5>
                <h6>€ <%= ((rental.end_date - rental.start_date) * Car.find(rental.car_id).price_per_day / (60*60*24)).round %> | <%= ((rental.end_date - rental.start_date) / (60*60*24)).round %> days</h6>
                <p>Pickup Address: <%=  Car.find(rental.car_id).pick_up_address %></p>
                <p>Start Date: <%= rental.start_date %></p>
                <p>End Date: <%= rental.end_date %></p>
                <p> <%= link_to "Review", new_rental_review_path(rental) %></p>

                <p><%= link_to "More about the car", car_path(rental.car_id), class: 'text-decoration-none' %> | <%= link_to "Cancel", rental_path(rental), method: :delete, data: { confirm: "Are you sure?" }, class: 'text-decoration-none' %></p>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
<div class="collapse" id="allyourcars">
  <div class="card card-body">
    <div class="container my-5">
      <h1>All your cars</h1>
      <div class="row">
        <% current_user.cars.each do |car| %>
          <div class="card col-4 m-4">
            <%= cl_image_tag car.photo.key, crop: :fill, class: "card-img-top" %>
            <div class="card-body">
              <h5 class="card-title"><%= car.brand %> - <%= car.model %> </h5>
              <p class="card-text"> <%= car.description %> </p>
            </div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item"> Address : <%= car.pick_up_address %> </li>
              <li class="list-group-item"> <%= car.price_per_day %> € per day</li>
            </ul>
            <div class="card-footer">
              <% if policy(car).edit? && policy(car).destroy? %>
                <p><%= link_to 'Edit',edit_car_path(car), class: 'text-decoration-none' %> | <%= link_to 'Delete',car_path(car), method: :delete, data: { confirm: "Are you sure?" }, class: 'text-decoration-none'%></p>
              <% end %>
              <% if policy(car).current_car_rentals? %>
                <%= link_to 'Who rents your car?', car_rentals_path(car), class: 'text-decoration-none' %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
